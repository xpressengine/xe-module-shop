<include target="_header.html" />

<div id="categories">
<h4>Categories</h4>
{$HTML_tree}
</div>

<script type="text/javascript">
jQuery(document).ready(function($){
	{$datasourceJS}

    $("#products .add_to_cart").click(function(){
	    $current_form = $(this).parent();

	    $product_srl = $current_form.find("#product_srl").val();

	    if(!$product_srl)
		{
			alert("There's a problem with the product you selected! It cannot be added to your cart.");
		}
	    else
		{
		    alert("When the cart will be ready, product " + $product_srl + " will be added!");
		}


	});


    $("#products .product select.level_1").change(function(){
	    $first_select = $(this);
	    $current_form = $first_select.parent("form");

	    $selected_value = $first_select.val();
		$product_srl = $current_form.parent(".product").attr("id").substr(8);

		$second_select = $first_select.next("select.level_2");
	    if($second_select.length)
		{
			$options_list = associated_products[$product_srl][$selected_value];
			$second_select.html("");
			$.each($options_list, function(attribute, associated_product_srl){
				$second_select.append("<option value='" + associated_product_srl + "'>" + attribute + "</option>");
			});

			$second_select.trigger("change");
		}
		else
		{
			$associated_product_srl = associated_products[$product_srl][$selected_value];
			$current_form.find("#product_srl").val($associated_product_srl);
		}

	});

	$("#products .product select.level_2").change(function(){
		$current_form = $(this).parent("form");
	    $selected_value = $(this).val();

	    $current_form.find("#product_srl").val($selected_value);
	});
});


</script>



<div id="products">
	<!--@foreach($products as $product)-->
		<div id="product_{$product->product_srl}" class="product">
			<!--@if($product->file_srl)-->
				<!-- TODO Add product image here -->
			<!--@else-->
				<img src="img/missingProductLarge.png" width="150px" height="150px" />
			<!--@end-->
			<span><a href="{getUrl('vid', $mid, 'act', 'dispShopProduct', 'product_srl', $product->product_srl)}">{$product->product_srl} - {$product->title}</a></span>
			<span>Price: {$product->price}</span>

			<form action="./">

			    <!--@if($product->isConfigurable())-->
				<!-- Display just first two attributes -->
				{@ $max_attributes = 2; $i = 1; }
				<!--@foreach($product->configurable_attributes as $attribute_srl => $attribute_title)-->
				    <!--@if($i > $max_attributes) break; -->
				    <!--@endif-->

				    {$attribute_title}
				    <select id="product_{$product->product_srl}_attribute_{$attribute_srl}_values" class="level_{$i}">
					    <!-- For first select, also display options -->
					    <!--@if($i == 1)-->
							{@ $already_added = array() }
						    <!--@foreach($product->associated_products as $asoc_product)-->
								{@ $current_value = $asoc_product->attributes[$attribute_srl] }
								<!--@if(!$already_added[$current_value])-->
						        	<option value="{$current_value}">{$current_value}</option>
								<!--@endif-->
						        {@ $already_added[$current_value] = true; }
							<!--@end-->
						<!--@endif-->

				    </select>
				    {@ $i++;}
				<!--@end-->
				<!--@end-->
				<input type="text" disabled="disabled" id="product_srl" name="product_srl" value="{$product->product_srl}" />
				<a href="#" class="add_to_cart">Add to cart</a>
			</form>

            <a class="cart add" href="{getUrl('', 'act','procShopToolCartAddProduct', 'entry', $product->friendly_url)}">add</a>
		</div>
	<!--@end-->
	<div class="clear"/>

	<!-- Pagination -->
	<!--@if($page_navigation)-->
	<div class="pagination">
		<a href="{getUrl('page','','mid',$mid)}" class="prev"><span>{$lang->first_page}</span></a>

		<!--@while($page_no = $page_navigation->getNextPage())-->
			<!--@if($page == $page_no)-->
				<strong>{$page_no}</strong>
			<!--@else-->
				<a href="{getUrl('page',$page_no,'mid',$mid)}">{$page_no}</a>
			<!--@end-->
		<!--@end-->

		<a href="{getUrl('page',$page_navigation->last_page,'module_srl','')}" class="next"><span>{$lang->last_page}</span></a>
	</div>
	<!--@end-->
	<!-- /Pagination -->

</div>

<include target="_footer.html"/>
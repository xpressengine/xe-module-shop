<include target="_header.html"/>
<!--%import("jquery.validate.js")-->

<script type="text/javascript">

    jQuery(function () {
        jQuery('#billing_address, #shipping_address')
                .change(function () {
                    var $this = jQuery(this);
                    var selected = $this.children(":selected");
                    var newAddress = ($this.is('#billing_address')) ? jQuery('#new-address-billing') : jQuery('#new-address-shipping');
                    if (selected.val() == 'new') newAddress.show(200); else newAddress.hide(200);
                }).filter('#billing_address').change();
        jQuery('#different_shipping').change(function(){
            var $this = jQuery(this);
            if (jQuery(this).is(':checked')) {
                var shippingSelect = jQuery('#shipping-address-select').show();
                if (shippingSelect.find('option:selected').val() == 'new') {
                    jQuery('#new-address-shipping').show();
                }
            }
            else {
                jQuery('#new-address-shipping, #shipping-address-select').hide();
            }
        }).change();

        //validations

        jQuery('#login_form').validate({
            rules: {
                'login[user]': { required: true, email: true },
                'login[pass]': "required"
            },
            messages: {
                'login[user]': { required: "Please specify your username", email: "Invalid email format for username" },
                'login[pass]': { required: "Please specify your password" }
            }
        });
        jQuery('#big').validate({ //http://docs.jquery.com/Plugins/Validation/validate#options
            rules: {
                'new_billing_address[firstname]': { required: true },
                'new_billing_address[lastname]': { required: true },
                'new_billing_address[email]': { required: true, email: true },
                'new_billing_address[telephone]': { required: true, phone: true },
                'new_billing_address[fax]': { phone: true },
                'new_billing_address[address]': { required: true, minlength: 10 },
                'new_shipping_address[firstname]': { required: '#different_shipping:checked' },
                'new_shipping_address[lastname]': { required: '#different_shipping:checked' },
                'new_shipping_address[email]': { required: '#different_shipping:checked', email: true },
                'new_shipping_address[telephone]': { required: '#different_shipping:checked', phone: true },
                'new_shipping_address[fax]': { required: '#different_shipping:checked', phone: true },
                'new_shipping_address[address]': { required: '#different_shipping:checked', minlength: 10 }
            },
            messages: {
                'new_billing_address[firstname]': { required: 'First name is mandatory' },
                'new_billing_address[lastname]': { required: 'Please enter last name' },
                'new_billing_address[email]': { required: 'Email contact for shipping address?', email: 'Wrong format for email' },
                'new_billing_address[telephone]': { required: 'Please provide the phone number', phone: 'Please enter a valid phone number for the billing address' },
                'new_billing_address[fax]': { phone: 'Please provide a valid fax number' },
                'new_billing_address[address]': { required: 'Forgot about address?', minlength: jQuery.format("At least {0} characters required for billing address!") },
                'new_shipping_address[firstname]': { required: 'First name is mandatory' },
                'new_shipping_address[lastname]': { required: 'Please enter last name' },
                'new_shipping_address[email]': { required: 'Email contact for shipping address?', email: 'Wrong format for email' },
                'new_shipping_address[telephone]': { required: 'Please provide the phone number', phone: 'Please enter a valid phone number for shipping' },
                'new_shipping_address[fax]': { phone: 'Please enter a valid fax number for shipping' },
                'new_shipping_address[address]': { required: 'Forgot about the shipping address?', minlength: jQuery.format("At least {0} characters required for shipping address!") }
            }
        });
        jQuery.validator.addMethod("phone", function(phone_number, element) {
            phone_number = phone_number.replace(/\s+/g, "");
            return this.optional(element) || phone_number.length > 5 &&
                    phone_number.match(/^[)\(0-9 -+]*$/);
                    //for US: phone_number.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/);
        }, "Please specify a valid phone number");
    });
</script>

<div id="checkout" class="main-content form" cond="isset($cart) && $cart->items">
    <h1 class="underline">{$lang->checkout}</h1>

    <div cond="$XE_VALIDATOR_MESSAGE" class="message {$XE_VALIDATOR_MESSAGE_TYPE}">
        <p>{$XE_VALIDATOR_MESSAGE}</p>
    </div>

    <form action="./" method="post" id="login_form" ruleset="checkout_login">
        <input type="hidden" name="act" value="procShopCheckoutLogin"/>

        <div id="login" cond="!$is_logged">
            <h2 class="underline">Already a customer?</h2>
            <ul>
                <p>
                    <label for="login_user">User (email)</label>
                    <input type="text" name="login[user]" id="login_user">
                </p>
                <p>
                    <label for="login_pass">Pass</label>
                    <input type="password" name="login[pass]" id="login_pass">
                </p>
                <p>
                    <input type="submit" id="login_button" value="Login" style="margin-left: 232px">
                </p>
            </ul>
        </div>
    </form>

    <form action="./" method="post" id="big" ruleset="checkout">
        <input type="hidden" id="act" name="act" value="procShopToolCheckout"/>
        <div id="billing">

            <h2 class="underline">Billing</h2>

            <!-- @if ($addresses) -->
            <p>
                <label for="billing_address">Billing address</label>
                <select style="width: 70%;" id="billing_address" name="billing[address]">
                    <option value="new">new address</option>
                    <!--@foreach ($addresses as $key=>$address)-->
                    <option value="{$address->address_srl}" selected="selected"|cond="$default_billing && $address->address_srl == $default_billing->address_srl">{$address}</option>
                    <!--@endforeach-->
                </select>
            </p>
            <!-- @endif -->

            <div id="new-address-billing" <!--@if ($addresses)--> style="display:none"<!--@endif-->>
                <p>
                    <input type="hidden" value="{$logged_info->member_srl}" name="new_billing_address[member_srl]">
                    <label for="new_billing_address_firstname">First name</label>
                    <input type="text" name="new_billing_address[firstname]" id="new_billing_address_firstname" value="{$extra['firstname']}">
                </p>
                <p>
                    <label for="new_billing_address_lastname">Last name</label>
                    <input type="text" name="new_billing_address[lastname]" id="new_billing_address_lastname" value="{$extra['lastname']}">
                </p>
                <p>
                    <label for="new_billing_address_email">Email</label>
                    <input type="text" name="new_billing_address[email]" id="new_billing_address_email" value="{$extra['email']}">
                </p>
                <p>
                    <label for="new_billing_address_company">Company</label>
                    <input type="text" name="new_billing_address[company]" id="new_billing_address_company">
                </p>
                <p>
                    <label for="new_billing_address_telephone">Telephone</label>
                    <input type="text" name="new_billing_address[telephone]" id="new_billing_address_telephone">
                </p>
                <p>
                    <label for="new_billing_address_fax">Fax</label>
                    <input type="text" name="new_billing_address[fax]" id="new_billing_address_fax">
                </p>
                <p>
                    <label for="new_billing_address_address">Address</label>
                    <textarea rows="5" id="new_billing_address_address" name="new_billing_address[address]"></textarea>
                </p>
                <p>
                    <label for="new_billing_address_additionalinfo">Additional Info</label>
                    <textarea rows="5" id="new_billing_address_additionalinfo" name="new_billing_address[additional_info]"></textarea>
                </p>
                <p>
                    <label for="new_billing_address_city">City</label>
                    <input type="text" name="new_billing_address[city]" id="new_billing_address_city">
                </p>
                <p>
                    <label for="new_billing_address_region">Region</label>
                    <input type="text" name="new_billing_address[region]" id="new_billing_address_region">
                </p>
                <p>
                    <label for="new_billing_address_postalcode">Postal Code</label>
                    <input type="text" name="new_billing_address[postal_code]" id="new_billing_address_postalcode">
                </p>
                <p>
                    <label for="new_billing_address_country">Country</label>
                    <input type="text" name="new_billing_address[country]" id="new_billing_address_country">
                </p>
            </div>
            <label for="different_shipping">Use different shipping address?</label>
            <input type="checkbox" name="different_shipping" id="different_shipping" value="yes" checked="yes"|cond="$needs_new_shipping">
        </div>

        <div id="shipping">
            <h2 class="underline">Shipping</h2>
            <p>
                <label for="shipping_method">Shipping method</label>
                <select name="shipping[method]" id="shipping_method">
                    <option value=""></option>
                    <!--@foreach($shipping_methods as $value=>$name)-->
                    <option value="{$value}" selected="selected"|cond="$cart->getShippingMethodName() == $value">{$name}</option>
                    <!--@endforeach-->
                </select>
            </p>

            <p id="shipping-address-select" style="display:none"|cond="!$needs_new_shipping">
                <label for="shipping_address">Shipping address</label>
                <select style="width: 70%;" id="shipping_address" name="shipping[address]">
                    <option value="new">new address</option>
                    <!--@foreach ($addresses as $key=>$address)-->
                    <option value="{$address->address_srl}" selected="selected"|cond="$default_shipping && $address->address_srl == $default_shipping->address_srl">{$address}</option>
                    <!--@endforeach-->
                </select>
            </p>

            <div id="new-address-shipping" style="display:none"|cond="$default_shipping || !$needs_new_shipping">

                <p>
                    <input type="hidden" value="{$logged_info->member_srl}" name="new_shipping_address[member_srl]">
                    <label for="new_shipping_address_firstname">First name</label>
                    <input type="text" name="new_shipping_address[firstname]" id="new_shipping_address_firstname" value="{$extra['firstname']}">
                </p>
                <p>
                    <label for="new_shipping_address_lastname">Last name</label>
                    <input type="text" name="new_shipping_address[lastname]" id="new_shipping_address_lastname" value="{$extra['lastname']}">
                </p>
                <p>
                    <label for="new_shipping_address_email">Email</label>
                    <input type="text" name="new_shipping_address[email]" id="new_shipping_address_email" value="{$extra['email']}">
                </p>
                <p>
                    <label for="new_shipping_address_company">Company</label>
                    <input type="text" name="new_shipping_address[company]" id="new_shipping_address_company">
                </p>
                <p>
                    <label for="new_shipping_address_telephone">Telephone</label>
                    <input type="text" name="new_shipping_address[telephone]" id="new_shipping_address_telephone">
                </p>
                <p>
                    <label for="new_shipping_address_fax">Fax</label>
                    <input type="text" name="new_shipping_address[fax]" id="new_shipping_address_fax">
                </p>
                <p>
                    <label for="new_shipping_address_address">Address</label>
                    <textarea rows="5" id="new_shipping_address_address" name="new_shipping_address[address]"></textarea>
                </p>
                <p>
                    <label for="new_shipping_address_additionalinfo">Additional Info</label>
                    <textarea rows="5" id="new_shipping_address_additionalinfo" name="new_shipping_address[additional_info]"></textarea>
                </p>
                <p>
                    <label for="new_shipping_address_city">City</label>
                    <input type="text" name="new_shipping_address[city]" id="new_shipping_address_city">
                </p>
                <p>
                    <label for="new_shipping_address_region">Region</label>
                    <input type="text" name="new_shipping_address[region]" id="new_shipping_address_region">
                </p>
                <p>
                    <label for="new_shipping_address_postalcode">Postal Code</label>
                    <input type="text" name="new_shipping_address[postal_code]"
                           id="new_shipping_address_postalcode">
                </p>
                <p>
                    <label for="new_shipping_address_country">Country</label>
                    <input type="text" name="new_shipping_address[country]" id="new_shipping_address_country">
                </p>

            </div>
        </div>

        <div id="payment">
            <h2 class="underline">Payment method</h2>
            <!--@foreach($payment_methods as $payment_method)-->
            <p>
                <input type="radio" id="payment_{$payment_method->name}" name="payment[method]" value="{$payment_method->name}"
                <!--@if($payment_method->name == $cart->getPaymentMethodName())-->
                checked
                <!--@end-->
                >
                <label for="payment_{$payment_method->name}">{$payment_method->getSelectPaymentHtml()}</label>
            </p>
            <!--@end-->
        </div>

        <div id="review">
            <h2 class="underline">Order review</h2>
            {@ $product_container = $cart; }
            <include target="product_items" />
        </div>

        <p class="f-left">
            <input type="submit" value="Continue"><br />
            {$lang->co_review_order}
        </p>
        <p class="f-right">
            Forgot something? <a class="button" href="{getUrl('act','dispShopCart')}" title="cart">Edit your cart</a>
        </p>
        <div class="clearfix"></div>

    </form>

</div>

<include target="_footer.html"/>